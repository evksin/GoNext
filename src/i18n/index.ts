import AsyncStorage from '@react-native-async-storage/async-storage';
import i18next from 'i18next';
import { initReactI18next } from 'react-i18next';

const STORAGE_KEY = 'gonext.language';

export const resources = {
  ru: {
    translation: {
      appTitle: 'GoNext',
      common: {
        back: 'Назад',
        home: 'Главная',
        save: 'Сохранить',
        cancel: 'Отмена',
        delete: 'Удалить',
        done: 'Готово',
        selected: 'Выбрано',
        yes: 'да',
        no: 'нет',
        notSpecified: 'не указано',
        dateFormat: 'ГГГГ-ММ-ДД',
        loading: 'Загрузка...',
        errorUnknown: 'Произошла ошибка.',
      },
      home: {
        places: 'Места',
        trips: 'Поездки',
        nextPlace: 'Следующее место',
        settings: 'Настройки',
        search: 'Поиск',
      },
      settings: {
        title: 'Настройки',
        appearance: 'Внешний вид',
        language: 'Язык',
        languageRu: 'Русский',
        languageEn: 'English',
        themeLight: 'Светлая',
        themeDark: 'Тёмная',
        fontNormal: 'Обычный',
        fontLarge: 'Крупный',
        primaryColor: 'Основной цвет',
        exportImport: 'Экспорт / импорт',
        dataJson: 'Данные (JSON)',
        export: 'Экспортировать',
        import: 'Импортировать',
        clear: 'Очистка',
        clearData: 'Очистить данные и фото',
        clearDialogTitle: 'Удалить данные?',
        clearDialogText: 'Будут удалены все места, поездки, теги и фото.',
        importDialogTitle: 'Импортировать данные?',
        importDialogText: 'Текущие данные будут заменены.',
        offlineCheck: 'Проверка офлайн',
        runCheck: 'Запустить проверку',
        checklist: 'Чек-лист сценариев',
        checklistPlace: 'Создать и отредактировать место',
        checklistTrip: 'Создать поездку и добавить места',
        checklistNotes: 'Отметить посещение, заметки, фото',
        checklistNext: 'Проверить «Следующее место»',
        checklistSearch: 'Проверить поиск по тексту/тегам/году',
        checklistBackup: 'Сделать экспорт/импорт',
        exportUnavailable: 'Экспорт недоступен в браузере.',
        importUnavailable: 'Импорт недоступен в браузере.',
        clearUnavailable: 'Очистка недоступна в браузере.',
        pasteImport: 'Вставьте данные для импорта.',
        exportOk: 'Экспорт выполнен.',
        importOk: 'Импорт выполнен.',
        clearOk: 'Данные и фото удалены.',
        exportFail: 'Не удалось выполнить экспорт.',
        importFail: 'Импорт не удался.',
        importInvalid: 'Неверный формат данных.',
        clearFail: 'Не удалось очистить данные.',
        checkDone: 'Проверка завершена.',
        checkFail: 'Не удалось выполнить проверку.',
      },
      places: {
        title: 'Места',
        newTitle: 'Новое место',
        editTitle: 'Редактирование места',
        listEmpty: 'Пока нет сохранённых мест.',
        loadError: 'Не удалось загрузить список мест.',
        name: 'Название',
        nameRequired: 'Введите название места.',
        description: 'Описание',
        visitLater: 'Хочу посетить',
        liked: 'Понравилось',
        coordinates: 'Координаты (DD)',
        coordinatesHint: 'Введите координаты в формате "широта, долгота".',
        coordinatesPlaceholder: '55.7558, 37.6176',
        tags: 'Теги',
        tagsPlaceholder: 'музей, прогулка, еда',
        createdAt: 'Создано',
        openMap: 'Открыть на карте',
        delete: 'Удалить',
        deleteConfirmTitle: 'Удалить место?',
        deleteConfirmText: 'Это действие нельзя отменить.',
        deleteFail: 'Не удалось удалить место.',
        loadFail: 'Не удалось загрузить место.',
        notFound: 'Место не найдено.',
        saveFail: 'Не удалось сохранить место.',
        invalidId: 'Некорректный идентификатор места.',
        tagsNone: 'нет',
      },
      trips: {
        title: 'Поездки',
        newTitle: 'Новая поездка',
        editTitle: 'Редактирование поездки',
        addPlacesTitle: 'Добавить места',
        listEmpty: 'Пока нет поездок.',
        loadError: 'Не удалось загрузить поездки.',
        invalidId: 'Некорректный идентификатор поездки.',
        notFound: 'Поездка не найдена.',
        loadFail: 'Не удалось загрузить поездку.',
        saveFail: 'Не удалось сохранить поездку.',
        titleLabel: 'Название',
        titleRequired: 'Введите название поездки.',
        descriptionLabel: 'Описание',
        startDate: 'Дата начала',
        endDate: 'Дата окончания',
        currentTrip: 'Текущая поездка',
        addPlaces: 'Добавить места',
        deleteTrip: 'Удалить поездку',
        deleteConfirmTitle: 'Удалить поездку?',
        deleteConfirmText: 'Все места в маршруте будут удалены.',
        deleteFail: 'Не удалось удалить поездку.',
        route: 'Маршрут',
        placesNotAdded: 'Места не добавлены.',
        selectAtLeastOne: 'Выберите хотя бы одно место.',
        addSuccess: 'Места добавлены: {{count}}',
        addFail: 'Не удалось добавить места.',
        tripId: 'ID',
        start: 'Начало',
        end: 'Окончание',
        current: 'Текущая',
        visited: 'Посещено',
        visitDate: 'Дата визита',
        visitDatePlaceholder: '—',
        notes: 'Заметки',
        photos: 'Фото',
        notesPhotos: 'Заметки/Фото',
        openNotesTitle: 'Заметки и фото',
        photoMissing: 'Фото не добавлены.',
        takePhoto: 'Сделать фото',
        cameraUnavailable: 'Камера недоступна в веб-версии.',
        cameraDenied: 'Нет доступа к камере.',
        photoSaveFail: 'Не удалось сохранить фото.',
        remove: 'Удалить',
        openTrip: 'К поездкам',
        tags: 'Теги',
        tagsPlaceholder: 'тур, зима, семья',
        noteTagsPlaceholder: 'вид, обед, музей',
        tagsNone: 'нет',
      },
      nextPlace: {
        title: 'Следующее место',
        noCurrentTrip: 'Нет текущей поездки',
        markCurrentTrip: 'Отметьте поездку как текущую.',
        allVisited: 'Все места посещены.',
        openMap: 'Открыть на карте',
        openPlace: 'Открыть место',
        coordinates: 'Координаты',
        coordsNotSpecified: 'не указаны',
        loadFail: 'Не удалось загрузить следующее место.',
        mapFail: 'Не удалось открыть карту.',
        coordsMissing: 'Координаты не указаны.',
      },
      search: {
        title: 'Поиск',
        places: 'Места',
        trips: 'Поездки',
        notes: 'Заметки',
        query: 'Поиск по тексту',
        tags: 'Теги',
        year: 'Год',
        search: 'Найти',
        enterCriteria: 'Введите критерии поиска.',
        nothingFound: 'Ничего не найдено.',
        yearInvalid: 'Год должен быть числом.',
        searchFail: 'Не удалось выполнить поиск.',
      },
      health: {
        offline: 'Офлайн-режим',
        offlineOk: 'Приложение работает без сети (SQLite + файлы).',
        offlineWeb: 'В браузере SQLite недоступен.',
        db: 'Локальная база данных',
        dbDetails: 'мест: {{places}}, поездок: {{trips}}',
        storage: 'Локальное хранилище фото',
        storageDetails: 'файлов: {{count}}',
      },
    },
  },
  en: {
    translation: {
      appTitle: 'GoNext',
      common: {
        back: 'Back',
        home: 'Home',
        save: 'Save',
        cancel: 'Cancel',
        delete: 'Delete',
        done: 'Done',
        selected: 'Selected',
        yes: 'yes',
        no: 'no',
        notSpecified: 'not specified',
        dateFormat: 'YYYY-MM-DD',
        loading: 'Loading...',
        errorUnknown: 'Something went wrong.',
      },
      home: {
        places: 'Places',
        trips: 'Trips',
        nextPlace: 'Next place',
        settings: 'Settings',
        search: 'Search',
      },
      settings: {
        title: 'Settings',
        appearance: 'Appearance',
        language: 'Language',
        languageRu: 'Русский',
        languageEn: 'English',
        themeLight: 'Light',
        themeDark: 'Dark',
        fontNormal: 'Normal',
        fontLarge: 'Large',
        primaryColor: 'Primary color',
        exportImport: 'Export / import',
        dataJson: 'Data (JSON)',
        export: 'Export',
        import: 'Import',
        clear: 'Clear',
        clearData: 'Clear data and photos',
        clearDialogTitle: 'Delete data?',
        clearDialogText: 'All places, trips, tags and photos will be removed.',
        importDialogTitle: 'Import data?',
        importDialogText: 'Current data will be replaced.',
        offlineCheck: 'Offline check',
        runCheck: 'Run check',
        checklist: 'Scenario checklist',
        checklistPlace: 'Create and edit a place',
        checklistTrip: 'Create a trip and add places',
        checklistNotes: 'Mark visited, notes, photos',
        checklistNext: 'Check “Next place”',
        checklistSearch: 'Check search by text/tags/year',
        checklistBackup: 'Do export/import',
        exportUnavailable: 'Export is not available on web.',
        importUnavailable: 'Import is not available on web.',
        clearUnavailable: 'Clear is not available on web.',
        pasteImport: 'Paste data to import.',
        exportOk: 'Export completed.',
        importOk: 'Import completed.',
        clearOk: 'Data and photos removed.',
        exportFail: 'Export failed.',
        importFail: 'Import failed.',
        importInvalid: 'Invalid data format.',
        clearFail: 'Clear failed.',
        checkDone: 'Check completed.',
        checkFail: 'Check failed.',
      },
      places: {
        title: 'Places',
        newTitle: 'New place',
        editTitle: 'Edit place',
        listEmpty: 'No places yet.',
        loadError: 'Failed to load places.',
        name: 'Name',
        nameRequired: 'Enter place name.',
        description: 'Description',
        visitLater: 'Want to visit',
        liked: 'Liked',
        coordinates: 'Coordinates (DD)',
        coordinatesHint: 'Enter coordinates as "lat, lng".',
        coordinatesPlaceholder: '55.7558, 37.6176',
        tags: 'Tags',
        tagsPlaceholder: 'museum, walk, food',
        createdAt: 'Created',
        openMap: 'Open on map',
        delete: 'Delete',
        deleteConfirmTitle: 'Delete place?',
        deleteConfirmText: 'This action cannot be undone.',
        deleteFail: 'Failed to delete place.',
        loadFail: 'Failed to load place.',
        notFound: 'Place not found.',
        saveFail: 'Failed to save place.',
        invalidId: 'Invalid place id.',
        tagsNone: 'none',
      },
      trips: {
        title: 'Trips',
        newTitle: 'New trip',
        editTitle: 'Edit trip',
        addPlacesTitle: 'Add places',
        listEmpty: 'No trips yet.',
        loadError: 'Failed to load trips.',
        invalidId: 'Invalid trip id.',
        notFound: 'Trip not found.',
        loadFail: 'Failed to load trip.',
        saveFail: 'Failed to save trip.',
        titleLabel: 'Title',
        titleRequired: 'Enter trip title.',
        descriptionLabel: 'Description',
        startDate: 'Start date',
        endDate: 'End date',
        currentTrip: 'Current trip',
        addPlaces: 'Add places',
        deleteTrip: 'Delete trip',
        deleteConfirmTitle: 'Delete trip?',
        deleteConfirmText: 'All route places will be removed.',
        deleteFail: 'Failed to delete trip.',
        route: 'Route',
        placesNotAdded: 'Places not added.',
        selectAtLeastOne: 'Select at least one place.',
        addSuccess: 'Places added: {{count}}',
        addFail: 'Failed to add places.',
        tripId: 'ID',
        start: 'Start',
        end: 'End',
        current: 'Current',
        visited: 'Visited',
        visitDate: 'Visit date',
        visitDatePlaceholder: '—',
        notes: 'Notes',
        photos: 'Photos',
        notesPhotos: 'Notes/Photos',
        openNotesTitle: 'Notes and photos',
        photoMissing: 'No photos added.',
        takePhoto: 'Take photo',
        cameraUnavailable: 'Camera is not available on web.',
        cameraDenied: 'Camera permission denied.',
        photoSaveFail: 'Failed to save photo.',
        remove: 'Remove',
        openTrip: 'Go to trips',
        tags: 'Tags',
        tagsPlaceholder: 'trip, winter, family',
        noteTagsPlaceholder: 'view, lunch, museum',
        tagsNone: 'none',
      },
      nextPlace: {
        title: 'Next place',
        noCurrentTrip: 'No current trip',
        markCurrentTrip: 'Mark a trip as current.',
        allVisited: 'All places are visited.',
        openMap: 'Open on map',
        openPlace: 'Open place',
        coordinates: 'Coordinates',
        coordsNotSpecified: 'not specified',
        loadFail: 'Failed to load next place.',
        mapFail: 'Failed to open map.',
        coordsMissing: 'Coordinates not specified.',
      },
      search: {
        title: 'Search',
        places: 'Places',
        trips: 'Trips',
        notes: 'Notes',
        query: 'Text search',
        tags: 'Tags',
        year: 'Year',
        search: 'Search',
        enterCriteria: 'Enter search criteria.',
        nothingFound: 'Nothing found.',
        yearInvalid: 'Year must be a number.',
        searchFail: 'Search failed.',
      },
      health: {
        offline: 'Offline mode',
        offlineOk: 'App works without network (SQLite + files).',
        offlineWeb: 'SQLite is not available on web.',
        db: 'Local database',
        dbDetails: 'places: {{places}}, trips: {{trips}}',
        storage: 'Local photo storage',
        storageDetails: 'files: {{count}}',
      },
    },
  },
};

export const initI18n = async (): Promise<void> => {
  const stored = await AsyncStorage.getItem(STORAGE_KEY);
  const lng = stored ?? 'ru';
  await i18next.use(initReactI18next).init({
    lng,
    fallbackLng: 'ru',
    resources,
    interpolation: { escapeValue: false },
  });
};

export const setLanguage = async (lng: 'ru' | 'en'): Promise<void> => {
  await AsyncStorage.setItem(STORAGE_KEY, lng);
  await i18next.changeLanguage(lng);
};

export const getStoredLanguage = async (): Promise<string | null> =>
  AsyncStorage.getItem(STORAGE_KEY);
